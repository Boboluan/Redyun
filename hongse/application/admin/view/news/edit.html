{include file="public/header" /}
<body class="gray-bg">
<div class="layui-fluid layui-col-md12">
    <div class="layui-card">
        <div class="layui-card-header">编辑文章</div>
        <div class="layui-card-body layui-form">
            <div class="layui-row layui-col-space10 layui-form-item ">
            <form action="" id="myform" enctype="multipart/form-data">
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">所属分类</label>
                    <div class="layui-input-block">
                        <select name="parent"  lay-search="">
                            <option value="">请选择分类</option>
                                   {volist name="parent" id="vo"}
                                    <option name="parent" value="{$vo.parent}">{$vo.title}</option>
                                    {/volist}
                        </select>
                    </div>
                </div>


                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">标题</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input "  value="{$res.title}" name="title" lay-verify="required" placeholder="文章标题">
                    </div>
                </div>
               
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">关键字</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input " value="{$res.keyword}" name="keyword" lay-verify="required" placeholder="文章关键字">
                    </div>
                </div>
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">描述</label>
                    <div class="layui-input-block">
                        <textarea  name="content" class="layui-textarea"  lay-verify="required"   placeholder="文章描述">{$res.content}</textarea>
                    </div>
                </div>
                 <input type="hidden" name="id" value="{$res.id}">
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8" id="imgkuan" >
                
                        图片预览： <img src="{$res.photo}" alt="" style="width:200px;height:100px; justify-content:center;">
                </div>
                

                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">图片上传</label>
                    <div class="layui-input-block">
                        <input type="hidden" name="photo" id="photo" lay-verify="image">
                        <div id="uploader" class="container">
                            <div class="queueList">
                                <div class="placeholder">
                                    <div id="filePicker"></div>
                                    <p>或将照片拖到这里</p>
                                </div>
                            </div>
                            <div class="statusBar" style="display:none;">
                                <div class="layui-progress layui-progress-big active" lay-showpercent="true">
                                    <div class="layui-progress-bar layui-bg-blue" lay-percent="0%">
                                    </div>
                                    <span></span>
                                </div>
                                <div class="info"></div>
                                <div class="btns">
                                    <div id="goPicker" class="filePicker2"></div>
                                    <div class="uploadBtn">开始上传</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
         
               
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">浏览量</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input " value="{$res.view}" name="view" lay-verify="required" placeholder="文章浏览量" onkeyup="value=value.replace(/[^\d]/g,'')">
                    </div>
                </div>
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">作者</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input " name="author" value="{$res.author}" lay-verify="required" placeholder="文章作者">
                    </div>
                </div>
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <label class="layui-form-label">是否显示</label>
                    <div class="layui-input-block">
                        <input type="radio" name="status" value="1" title="是" checked>
                        <input type="radio" name="status" value="0" title="否" >
                    </div>
                </div>
                </form>
                <div class="layui-form-item layui-col-md-offset1 layui-col-md8">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" id="suBtn" onclick="submit()" lay-filter="component-form-element">保存
                        </button>
                        <button class="layui-btn layui-btn-primary" onclick="back()">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{include file="public/footer" /}
<script>

    //自定义上传接口
    UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;
    UE.Editor.prototype.getActionUrl = function(action) {
        if (action == 'uploadimage' || action == 'uploadscrawl') {
            return '/admin/upload/ueditorUpload';//这就是自定义的上传地址
        } else {
            return this._bkGetActionUrl.call(this, action);
        }
    }
    var n = wk.uploads({num:3,type:'png',url:"{:url('admin/upload/uploadLocality')}"});
    var n1 = wk.uploads({num:4,type:'jpg',attr:1});
    var n2 = wk.uploads({num:6,type:'jpg,png',attr:2});
    function imgDel(e,obj){
        wk.uploads_del(e,obj,n,"{:url('admin/upload/deleteLocality')}");
    }
    function imgDel1(e,obj){
        wk.uploads_del(e,obj,n1);
    }
    function imgDel2(e,obj){
        wk.uploads_del(e,obj,n2);
    }
    var editor = wk.wang({elem:'#LAY_editor'});
    var index = wk.layeditor('LAY_editor1');
    wk.uploadImg({size:2,type:'png',url:"{:url('Upload/upload')}",domain:"{:config('qiniu.domain')}"});
    wk.uploadImg({size:5,num:1,type:'jpg',url:"{:url('Upload/upload')}",domain:"{:config('qiniu.domain')}"});
    wk.uploadMusic({size:100,type:'mp3',url:"{:url('Upload/upload')}",domain:"{:config('qiniu.domain')}"});
    var uploader = WebUploader.create({
        //上传成功
        'onUploadSuccess': function(file, data, response) {
            layui.config({
                base: '/src/' //静态资源所在路径
            }).extend({
                ckplayer: 'modules/ckplayer'
            }).use(['ckplayer'], function() {
                var ckplayer = layui.ckplayer
                var videoObject = {
                    container: '#' + file.id,
                    loop: false,
                    autoplay: false,
                    video: [
                        [data._raw, 'video/mp4']
                    ]
                };
                var player = new ckplayer(videoObject);
            })
            $( '#'+file.id ).show();
            $( '#'+file.id ).next('div').hide();
            $( '#'+file.id ).next().next('p').html('<span style="color: #009688;">上传成功!</span>');
        },
    });

       //提交
       function submit(){
        $.ajax({
                url:"{:url('news/editFun')}",
                type:'post',
                dataType:'json',
                data:$("#myform").serialize(),
                success:function(res){
                    if (res.code == 200) {
                        layer.msg(res.msg,{icon:1,time:1500,shade:0.1},function(index){
                            wk.layer_close();
                            history.go(0);//刷新当前
                        })
                    } else {
                        $(".layui-btn").removeClass('layui-disabled').removeAttr('disabled');
                        wk.error(res.msg);
                        return false;
                    }
                }
            })
       }

       function back(){
       window.location="{:url('news/index')}";
       }
</script>
</body>
</html>